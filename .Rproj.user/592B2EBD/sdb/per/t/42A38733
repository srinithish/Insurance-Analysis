{
    "collab_server" : "",
    "contents" : "library(dtplyr)\nlibrary(data.table)\nlibrary(dplyr)\nlibrary(corrplot)\nlibrary(psych)\nlibrary(ggplot2)\nlibrary(MASS)\nlibrary(forcats)\n\ninsurance_Original = fread(choose.files())\nstr(insurance_Original)\ncormatrix = cor(insurance_Original[,c(1,3,4,7)])\ncorplot = corrplot(cormatrix)\npairs.panels(insurance_Original)\n\n#draw histograms for each to find the distributions \n# Classes ‘data.table’ and 'data.frame':\t1338 obs. of  7 variables:\n#   $ age     : int  19 18 28 33 32 31 46 37 37 60 ...\n# $ sex     : chr  \"female\" \"male\" \"male\" \"male\" ...\n# $ bmi     : num  27.9 33.8 33 22.7 28.9 ...\n# $ children: int  0 1 3 0 0 0 1 3 2 0 ...\n# $ smoker  : chr  \"yes\" \"no\" \"no\" \"no\" ...\n# $ region  : chr  \"southwest\" \"southeast\" \"southeast\" \"northwest\" ...\n# $ charges : num  16885 1726 4449 21984 3867 ...\n# - attr(*, \".internal.selfref\")=<externalptr> \n#\n\nstr(insuranceMutated)\n# age            sex                 bmi           children        smoker         \n# Min.   :18.00   Length:1338        Min.   :15.96   Min.   :0.000   Length:1338       \n# 1st Qu.:27.00   Class :character   1st Qu.:26.30   1st Qu.:0.000   Class :character  \n# Median :39.00   Mode  :character   Median :30.40   Median :1.000   Mode  :character  \n# Mean   :39.21                      Mean   :30.66   Mean   :1.095                     \n# 3rd Qu.:51.00                      3rd Qu.:34.69   3rd Qu.:2.000                     \n# Max.   :64.00                      Max.   :53.13   Max.   :5.000                     \n# region             charges      ChildrenBin          logCharges    \n# Length:1338        Min.   : 1122   Length:1338        Min.   : 7.023  \n# Class :character   1st Qu.: 4740   Class :character   1st Qu.: 8.464  \n# Mode  :character   Median : 9382   Mode  :character   Median : 9.147  \n# Mean   :13270                      Mean   : 9.099  \n# 3rd Qu.:16640                      3rd Qu.: 9.720  \n# Max.   :63770                      Max.   :11.063  \n\n\nsummary(insuranceMutated)\ntable(insurance_Original$children)\nplotCanvas = ggplot(data = insuranceMutated)\n\n##creating factor for bmi\n\nplotCanvas+geom_histogram(mapping = aes(x=bmi),binwidth = 2)\n\ninsuranceMutated$bmiClass = cut(insuranceMutated$bmi,breaks = c(0,16,17,18.5,24.9,29.9,34.9,39.9,60),\n    labels = c(\"SevereM\",\"ModerateM\",\"MildM\",\"Normal\",\"OverWeight\",\"Obese1\",\"Obese2\",\"Obese3\"))\n\ninsuranceMutated = insuranceMutated %>% mutate(bmiCollapsedClass = fct_collapse(bmiClass,\n                                                            underWeight = c(\"SevereM\",\"ModerateM\",\"MildM\"),\n                                                            normal = c(\"Normal\"),\n                                                            OverWeight = c(\"OverWeight\",\"Obese1\",\"Obese2\",\"Obese3\")\n                                                            )) %>% mutate(children = as.factor(children))\n\n## creting factor for childeer\ninsuranceMutated = insurance_Original\nchildrenDIst  = ggplot(data = insuranceMutated) +\n                geom_histogram(mapping = aes(x=insuranceMutated$children))+ \n                labs(x = \"Number of children\") \n\ninsuranceMutated$ChildrenBin = ifelse(insuranceMutated$children == 0,\"NoChildren\",\n                                      ifelse((insurance_Original$children > 0 & insurance_Original$children <=2),\"1to2Children\",\n                                             \"3to5 Children\")\n                                      \n                                      )\n\ntable(insuranceMutated$ChildrenBin)\ntable(insuranceMutated[,c(\"sex\",\"smoker\")])\n\n\n###age distribuition plot\nagePlot  =  ggplot(data=insuranceMutated)+geom_histogram(binwidth = 10,mapping = aes(x=age),color = \"blue\",fill=\"orange\") \ntable(insuranceMutated$age)\n?geom_bar\nbraeakpoints = seq(15,65,10)\ntable(cut(insuranceMutated$age,breaks = braeakpoints))\n?geom_histogram\nagePlot$data\n\n###check charges against age distribution within males and females\n\np4  = ggplot(data = insuranceMutated)+geom_jitter(mapping = aes(x=age,y=charges,color = smoker,shape=bmiCollapsedClass),height = 4,width = 4,alpha = 1/3)+\n  facet_wrap(~sex)\nggsave(\"ChargesVsAge_Smoker_bmi.jpg\",p4)\n\n#charges distribution within regions and bifurcated by sex \np5 = ggplot(data = insuranceMutated) + geom_area(mapping = aes(x=charges),stat = \"bin\")+facet_wrap(~sex+region)\n\nggsave(filename = \"f_m_s_ns_cahrges_age.jpg\",plot = p4,dpi = 1000)\n\n####bmki vs charges\n\np6 = ggplot(data = insuranceMutated)+ geom_jitter(mapping = aes(x=bmi,y=charges,color=smoker),width = 3,alpha=1/2)\n\n###check about children vs charges distribution\np7 = plotCanvas + geom_boxplot(mapping = aes(x=as.factor(ChildrenBin),y=charges))\n\n# chrges distribution \n\nplotCanvas+geom_histogram(mapping = aes(x=log(charges)),binwidth = 0.1)\n\n\n\ninsuranceMutated$logCharges = log(insuranceMutated$charges)\n\nlinearModel = lm(logCharges~region+sex+age+smoker+bmiCollapsedClass+children,data = insuranceMutated)\n\nsummary(linearModel)\nstepAIC(linearModel,direction = \"both\")\nresidualsLM =  as.data.frame(linearModel$residuals)\ncolnames(residualsLM) = c(\"res\")\nggplot()+geom_histogram(mapping = aes(x=res),data = residualsLM)\ncolnames(insuranceMutated)\n",
    "created" : 1509334856433.000,
    "dirty" : false,
    "encoding" : "UTF-8",
    "folds" : "",
    "hash" : "3525549600",
    "id" : "42A38733",
    "lastKnownWriteTime" : 1509641813,
    "last_content_update" : 1509641813645,
    "path" : "M:/Data analytics/My R Projects/Project insurance/Insurance/EDA.R",
    "project_path" : "EDA.R",
    "properties" : {
        "tempName" : "Untitled1"
    },
    "relative_order" : 1,
    "source_on_save" : false,
    "source_window" : "",
    "type" : "r_source"
}